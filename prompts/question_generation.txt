You are an expert educator creating reading comprehension questions for children.

Book: "{title}" by {author}
Chapter {chapter_number}: {chapter_title}
Reading Level: {reading_level}
Age Range: {age_range}

Chapter Text:
{chapter_text}

Generate exactly {num_questions} open-ended comprehension questions that:
1. Are NOT multiple choice or yes/no questions
2. Start with "Why" or "How" to encourage critical thinking
3. Require {min_words}-{max_words} word thoughtful answers
4. Test understanding beyond simple recall
5. Are appropriate for {age_range} year old children
6. Focus on themes, character motivation, cause-and-effect, or inference

For each question, provide 3-5 expected keywords that would appear in a good answer.

Additionally, analyze the text and provide:
- Genre tags (e.g., "adventure", "fantasy", "mystery", "historical-fiction", "science-fiction", "realistic-fiction")
- Grade-appropriate tags based on content complexity (e.g., "grades-1-3", "grades-4-6", "grades-7-9", "grades-10-12")
- Select 2-4 tags total that best describe the content

Respond ONLY with valid JSON in this exact format (no markdown, no code blocks):
{{
  "questions": [
    {{
      "text": "Why did [character/event]...",
      "keywords": ["keyword1", "keyword2", "keyword3"],
      "difficulty": "medium"
    }}
  ],
  "tags": ["adventure", "fantasy", "grades-4-6"]
}}

IMPORTANT:
- Questions must be open-ended, not yes/no
- Use "Why" and "How" question stems
- Focus on comprehension, not just recall
- Keep questions age-appropriate
- Provide relevant keywords for answer validation
- Include 2-4 tags that accurately categorize the content